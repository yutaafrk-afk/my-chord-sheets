<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ–ãƒ­ãƒƒã‚¯å¼ã‚³ãƒ¼ãƒ‰è­œ v3 - ã‚³ãƒ”ãƒšå¯¾å¿œ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding-bottom: 80px; }
        .container { max-width: 100%; padding: 12px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 16px; margin: -12px -12px 16px -12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header h1 { font-size: 20px; font-weight: bold; }
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        .card-title { font-size: 18px; font-weight: bold; margin-bottom: 12px; color: #333; }
        .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
        .tab { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .tab-inactive { background: #e5e7eb; color: #6b7280; }
        .tab-chord { background: #3b82f6; color: white; }
        .tab-lyric { background: #f59e0b; color: white; }
        .tab-import { background: #10b981; color: white; }
        .input-group { margin-bottom: 16px; }
        .label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .input { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; }
        .input:focus { outline: none; border-color: #3b82f6; }
        .textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; min-height: 120px; resize: vertical; font-family: 'Courier New', monospace; }
        .select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; background: white; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:active { background: #2563eb; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:active { background: #d97706; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:active { background: #059669; }
        .btn-small { padding: 8px 12px; font-size: 14px; width: auto; display: inline-block; margin: 4px; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:active { background: #dc2626; }
        .key-selector { display: flex; gap: 8px; align-items: center; }
        .key-note { flex: 1; }
        .key-type { display: flex; gap: 8px; }
        .key-type-btn { flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; font-weight: 600; cursor: pointer; }
        .key-type-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .block-item { background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; align-items: flex-start; gap: 12px; }
        .block-checkbox { width: 24px; height: 24px; margin-top: 4px; cursor: pointer; }
        .block-content { flex: 1; }
        .block-chord { border-left: 4px solid #3b82f6; background: #eff6ff; }
        .block-lyric { border-left: 4px solid #f59e0b; background: #fffbeb; }
        .block-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .block-type { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; color: #6b7280; }
        .block-controls { display: flex; gap: 8px; }
        .icon-btn { width: 32px; height: 32px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; background: #f3f4f6; color: #6b7280; }
        .icon-btn:active { background: #e5e7eb; }
        .icon-btn-danger { background: #fee2e2; color: #dc2626; }
        .insert-position { background: #f0fdf4; border: 2px solid #22c55e; border-radius: 8px; padding: 12px; margin-bottom: 16px; }
        .insert-position-list { max-height: 200px; overflow-y: auto; }
        .insert-position-item { padding: 10px; margin-bottom: 8px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .insert-position-item:active { background: #f3f4f6; }
        .insert-position-item.selected { background: #dbeafe; border-color: #3b82f6; }
        .preview { background: #f9fafb; border-radius: 8px; padding: 16px; min-height: 150px; }
        .preview-chord { color: #3b82f6; font-weight: bold; margin-bottom: 4px; }
        .preview-lyric { margin-bottom: 4px; line-height: 1.6; }
        .empty-state { text-align: center; padding: 40px 20px; color: #9ca3af; }
        .badge { display: inline-block; background: #e5e7eb; color: #6b7280; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .hint { font-size: 13px; color: #6b7280; margin-top: 8px; line-height: 1.5; }
        .selection-controls { position: sticky; top: 0; background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 5; }
        .char-box { display: inline-block; padding: 4px 6px; margin: 2px; border: 2px solid #e5e7eb; border-radius: 4px; cursor: pointer; min-width: 24px; text-align: center; }
        .char-box.selected { background: #3b82f6; color: white; border-color: #3b82f6; }
        .import-preview { background: #f0fdf4; border: 2px solid #22c55e; border-radius: 8px; padding: 12px; margin-top: 12px; max-height: 300px; overflow-y: auto; }
        .import-preview-item { padding: 8px; margin-bottom: 4px; border-radius: 4px; }
        .import-preview-chord { background: #dbeafe; color: #1e40af; font-weight: bold; }
        .import-preview-lyric { background: #fef3c7; color: #78350f; }
        .example-box { background: #f9fafb; border: 2px dashed #d1d5db; border-radius: 8px; padding: 12px; margin-top: 8px; font-family: 'Courier New', monospace; font-size: 13px; white-space: pre-wrap; color: #374151; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const BlockEditor = () => {
            const [blocks, setBlocks] = useState([]);
            const [activeTab, setActiveTab] = useState('import');
            const [songKey, setSongKey] = useState('C');
            const [keyType, setKeyType] = useState('major');
            
            // æ­Œè©å…¥åŠ›
            const [lyricInput, setLyricInput] = useState('');
            const [lyricSize, setLyricSize] = useState(20);
            
            // ã‚³ãƒ¼ãƒ‰å…¥åŠ›
            const [chordInput, setChordInput] = useState('');
            const [chordSize, setChordSize] = useState(16);
            const [insertPosition, setInsertPosition] = useState(null);
            
            // ã‚³ãƒ”ãƒšå–ã‚Šè¾¼ã¿
            const [importText, setImportText] = useState('');
            const [importPreview, setImportPreview] = useState([]);
            
            // é¸æŠãƒ»ç·¨é›†
            const [selectedBlocks, setSelectedBlocks] = useState([]);
            const [selectedChars, setSelectedChars] = useState([]);

            // ã‚³ãƒ¼ãƒ‰åˆ¤å®šï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã€æ•°å­—ã€è¨˜å·ã®ã¿ï¼‰
            const isChordLine = (line) => {
                const trimmed = line.trim();
                if (!trimmed) return false;
                // ã‚³ãƒ¼ãƒ‰ã£ã½ã„ãƒ‘ã‚¿ãƒ¼ãƒ³: C, Am, F7, G/B, Cadd9 ãªã©
                const chordPattern = /^[A-G][#b]?(?:m|maj|min|sus|dim|aug|add|M)?\d*(?:\/[A-G][#b]?)?(?:\s+[A-G][#b]?(?:m|maj|min|sus|dim|aug|add|M)?\d*(?:\/[A-G][#b]?)?)*$/;
                return chordPattern.test(trimmed);
            };

            // ã‚³ãƒ”ãƒšãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ‘ãƒ¼ã‚¹
            const parseImportText = () => {
                if (!importText.trim()) {
                    setImportPreview([]);
                    return;
                }

                const lines = importText.split('\n');
                const parsed = [];

                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (!trimmed) return; // ç©ºè¡Œã¯ã‚¹ã‚­ãƒƒãƒ—

                    if (isChordLine(trimmed)) {
                        // ã‚³ãƒ¼ãƒ‰è¡Œ
                        parsed.push({
                            type: 'chord',
                            content: trimmed,
                            fontSize: chordSize
                        });
                    } else {
                        // æ­Œè©è¡Œ
                        parsed.push({
                            type: 'lyric',
                            content: trimmed,
                            fontSize: lyricSize,
                            charSizes: trimmed.split('').map(() => lyricSize)
                        });
                    }
                });

                setImportPreview(parsed);
            };

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´æ™‚ï¼‰
            React.useEffect(() => {
                parseImportText();
            }, [importText]);

            // å–ã‚Šè¾¼ã¿å®Ÿè¡Œ
            const executeImport = () => {
                if (importPreview.length === 0) {
                    alert('å–ã‚Šè¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                    return;
                }

                const newBlocks = importPreview.map((item, idx) => ({
                    ...item,
                    id: Date.now() + idx
                }));

                setBlocks([...blocks, ...newBlocks]);
                setImportText('');
                setImportPreview([]);
                alert(`${newBlocks.length}å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
            };

            // æ­Œè©è¿½åŠ 
            const addLyric = () => {
                if (!lyricInput.trim()) return;
                const lines = lyricInput.split('\n').filter(line => line.trim());
                const newBlocks = lines.map((line, idx) => ({
                    id: Date.now() + idx,
                    type: 'lyric',
                    content: line,
                    fontSize: lyricSize,
                    charSizes: line.split('').map(() => lyricSize)
                }));
                setBlocks([...blocks, ...newBlocks]);
                setLyricInput('');
            };

            // ã‚³ãƒ¼ãƒ‰è¿½åŠ 
            const addChord = () => {
                if (!chordInput.trim() || insertPosition === null) {
                    alert('ã‚³ãƒ¼ãƒ‰ã¨æŒ¿å…¥ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const lines = chordInput.split('\n').filter(line => line.trim());
                const newChordBlocks = lines.map((line, idx) => ({
                    id: Date.now() + idx,
                    type: 'chord',
                    content: line.trim(),
                    fontSize: chordSize
                }));

                const newBlocks = [...blocks];
                let insertIndex = insertPosition.index;
                
                if (insertPosition.type === 'after') {
                    insertIndex = insertPosition.index + 1;
                }
                
                newBlocks.splice(insertIndex, 0, ...newChordBlocks);
                setBlocks(newBlocks);
                setChordInput('');
                setInsertPosition(null);
            };

            // ãƒ–ãƒ­ãƒƒã‚¯å‰Šé™¤
            const deleteBlock = (id) => {
                setBlocks(blocks.filter(b => b.id !== id));
                setSelectedBlocks(selectedBlocks.filter(sid => sid !== id));
            };

            // é¸æŠãƒ–ãƒ­ãƒƒã‚¯å‰Šé™¤
            const deleteSelectedBlocks = () => {
                if (selectedBlocks.length === 0) return;
                if (!confirm(`${selectedBlocks.length}å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
                setBlocks(blocks.filter(b => !selectedBlocks.includes(b.id)));
                setSelectedBlocks([]);
            };

            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒˆã‚°ãƒ«
            const toggleBlockSelection = (id) => {
                if (selectedBlocks.includes(id)) {
                    setSelectedBlocks(selectedBlocks.filter(sid => sid !== id));
                } else {
                    setSelectedBlocks([...selectedBlocks, id]);
                }
            };

            // å…¨é¸æŠ/è§£é™¤
            const toggleSelectAll = () => {
                if (selectedBlocks.length === blocks.length) {
                    setSelectedBlocks([]);
                } else {
                    setSelectedBlocks(blocks.map(b => b.id));
                }
            };

            // é¸æŠãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸Šã«ç§»å‹•
            const moveSelectedBlocksUp = () => {
                if (selectedBlocks.length === 0) return;
                
                const selectedIndices = blocks
                    .map((b, idx) => selectedBlocks.includes(b.id) ? idx : -1)
                    .filter(idx => idx !== -1)
                    .sort((a, b) => a - b);
                
                if (selectedIndices[0] === 0) return;
                
                const newBlocks = [...blocks];
                selectedIndices.forEach(idx => {
                    [newBlocks[idx], newBlocks[idx - 1]] = [newBlocks[idx - 1], newBlocks[idx]];
                });
                setBlocks(newBlocks);
            };

            // é¸æŠãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸‹ã«ç§»å‹•
            const moveSelectedBlocksDown = () => {
                if (selectedBlocks.length === 0) return;
                
                const selectedIndices = blocks
                    .map((b, idx) => selectedBlocks.includes(b.id) ? idx : -1)
                    .filter(idx => idx !== -1)
                    .sort((a, b) => b - a);
                
                if (selectedIndices[0] === blocks.length - 1) return;
                
                const newBlocks = [...blocks];
                selectedIndices.forEach(idx => {
                    [newBlocks[idx], newBlocks[idx + 1]] = [newBlocks[idx + 1], newBlocks[idx]];
                });
                setBlocks(newBlocks);
            };

            // æ–‡å­—é¸æŠ
            const toggleCharSelection = (blockId, charIndex) => {
                const key = `${blockId}-${charIndex}`;
                if (selectedChars.includes(key)) {
                    setSelectedChars(selectedChars.filter(k => k !== key));
                } else {
                    setSelectedChars([...selectedChars, key]);
                }
            };

            // é¸æŠæ–‡å­—ã®ã‚µã‚¤ã‚ºå¤‰æ›´
            const changeSelectedCharsSize = (newSize) => {
                if (selectedChars.length === 0) return;
                const newBlocks = blocks.map(block => {
                    if (block.type === 'lyric') {
                        const newCharSizes = [...block.charSizes];
                        selectedChars.forEach(key => {
                            const [blockId, charIdx] = key.split('-');
                            if (parseInt(blockId) === block.id) {
                                newCharSizes[parseInt(charIdx)] = newSize;
                            }
                        });
                        return { ...block, charSizes: newCharSizes };
                    }
                    return block;
                });
                setBlocks(newBlocks);
                setSelectedChars([]);
            };

            // ã‚­ãƒ¼è¡¨è¨˜
            const getKeyDisplay = () => {
                return keyType === 'minor' ? `${songKey}m` : songKey;
            };

            return (
                <div>
                    <div className="header">
                        <h1>ğŸ¸ ãƒ–ãƒ­ãƒƒã‚¯å¼ã‚³ãƒ¼ãƒ‰è­œ v3</h1>
                        <div style={{ fontSize: '13px', marginTop: '4px', opacity: 0.9 }}>
                            {blocks.length}å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ | Key: {getKeyDisplay()}
                        </div>
                    </div>

                    <div className="container">
                        {/* ã‚­ãƒ¼é¸æŠ */}
                        <div className="card">
                            <div className="card-title">æ›²ã®ã‚­ãƒ¼</div>
                            <div className="key-selector">
                                <div className="key-note">
                                    <select value={songKey} onChange={(e) => setSongKey(e.target.value)} className="select">
                                        {['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'].map(note => (
                                            <option key={note} value={note}>{note}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="key-type">
                                    <button 
                                        className={`key-type-btn ${keyType === 'major' ? 'active' : ''}`}
                                        onClick={() => setKeyType('major')}
                                    >
                                        ãƒ¡ã‚¸ãƒ£ãƒ¼
                                    </button>
                                    <button 
                                        className={`key-type-btn ${keyType === 'minor' ? 'active' : ''}`}
                                        onClick={() => setKeyType('minor')}
                                    >
                                        ãƒã‚¤ãƒŠãƒ¼
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* å…¥åŠ›ã‚¨ãƒªã‚¢ */}
                        <div className="card">
                            <div className="card-title">å…¥åŠ›</div>
                            
                            <div className="tabs">
                                <button onClick={() => setActiveTab('import')} className={`tab ${activeTab === 'import' ? 'tab-import' : 'tab-inactive'}`}>
                                    ğŸ“‹ ã‚³ãƒ”ãƒš
                                </button>
                                <button onClick={() => setActiveTab('lyric')} className={`tab ${activeTab === 'lyric' ? 'tab-lyric' : 'tab-inactive'}`}>
                                    ğŸ¤ æ­Œè©
                                </button>
                                <button onClick={() => setActiveTab('chord')} className={`tab ${activeTab === 'chord' ? 'tab-chord' : 'tab-inactive'}`}>
                                    ğŸµ ã‚³ãƒ¼ãƒ‰
                                </button>
                            </div>

                            {activeTab === 'import' ? (
                                <div>
                                    <div className="input-group">
                                        <label className="label">ã‚³ãƒ¼ãƒ‰è­œã‚’è²¼ã‚Šä»˜ã‘ï¼ˆU-FRETãªã©ï¼‰</label>
                                        <textarea
                                            value={importText}
                                            onChange={(e) => setImportText(e.target.value)}
                                            className="textarea"
                                            placeholder="ã“ã“ã«ã‚³ãƒ¼ãƒ‰è­œã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"
                                            style={{ minHeight: '200px' }}
                                        ></textarea>
                                        <div className="hint">
                                            ğŸ’¡ U-FRETã‚„ChordWikiã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸã‚³ãƒ¼ãƒ‰è­œã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„<br/>
                                            è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ã¨æ­Œè©ã‚’è­˜åˆ¥ã—ã¾ã™
                                        </div>
                                    </div>

                                    <div className="example-box">
                                        <strong>ã€ä¾‹ã€‘</strong>{'\n'}
                                        C        Am{'\n'}
                                        ã‚ã‚Œã‹ã‚‰åƒ•ãŸã¡ã¯{'\n'}
                                        F           G{'\n'}
                                        ä½•ã‹ã‚’ä¿¡ã˜ã¦ããŸã‹ãª
                                    </div>

                                    {importPreview.length > 0 && (
                                        <div className="import-preview">
                                            <div style={{ fontWeight: 'bold', marginBottom: '8px', color: '#065f46' }}>
                                                âœ“ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ{importPreview.length}è¡Œï¼‰
                                            </div>
                                            {importPreview.map((item, idx) => (
                                                <div 
                                                    key={idx}
                                                    className={`import-preview-item ${item.type === 'chord' ? 'import-preview-chord' : 'import-preview-lyric'}`}
                                                >
                                                    {item.type === 'chord' ? 'ğŸµ' : 'ğŸ¤'} {item.content}
                                                </div>
                                            ))}
                                            <button onClick={executeImport} className="btn btn-success" style={{ marginTop: '12px' }}>
                                                å–ã‚Šè¾¼ã‚€
                                            </button>
                                        </div>
                                    )}
                                </div>
                            ) : activeTab === 'lyric' ? (
                                <div>
                                    <div className="input-group">
                                        <label className="label">æ­Œè©ï¼ˆæ”¹è¡Œã§è¤‡æ•°è¡Œï¼‰</label>
                                        <textarea
                                            value={lyricInput}
                                            onChange={(e) => setLyricInput(e.target.value)}
                                            className="textarea"
                                            placeholder="æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;æ”¹è¡Œã§è¤‡æ•°è¡Œè¿½åŠ ã§ãã¾ã™"
                                        ></textarea>
                                    </div>
                                    <div className="input-group">
                                        <label className="label">åŸºæœ¬æ–‡å­—ã‚µã‚¤ã‚º</label>
                                        <select value={lyricSize} onChange={(e) => setLyricSize(parseInt(e.target.value))} className="select">
                                            {[12, 14, 16, 18, 20, 22, 24, 28].map(size => (
                                                <option key={size} value={size}>{size}pt</option>
                                            ))}
                                        </select>
                                    </div>
                                    <button onClick={addLyric} className="btn btn-warning">è¿½åŠ </button>
                                </div>
                            ) : (
                                <div>
                                    {blocks.length === 0 ? (
                                        <div className="empty-state" style={{ padding: '20px' }}>
                                            <div style={{ fontSize: '16px', color: '#6b7280' }}>
                                                å…ˆã«æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="insert-position">
                                                <label className="label">æŒ¿å…¥ä½ç½®ã‚’é¸æŠ</label>
                                                <div className="insert-position-list">
                                                    <div 
                                                        className={`insert-position-item ${insertPosition?.type === 'before' && insertPosition?.index === 0 ? 'selected' : ''}`}
                                                        onClick={() => setInsertPosition({ type: 'before', index: 0 })}
                                                    >
                                                        <span>ğŸ“ ä¸€ç•ªæœ€åˆ</span>
                                                    </div>
                                                    {blocks.map((block, idx) => (
                                                        <div key={block.id}>
                                                            <div 
                                                                className={`insert-position-item ${insertPosition?.type === 'after' && insertPosition?.index === idx ? 'selected' : ''}`}
                                                                onClick={() => setInsertPosition({ type: 'after', index: idx })}
                                                            >
                                                                <span>
                                                                    {block.type === 'chord' ? 'ğŸµ' : 'ğŸ¤'} 
                                                                    {' '}{block.content.substring(0, 20)}{block.content.length > 20 ? '...' : ''}
                                                                </span>
                                                                <span style={{ color: '#6b7280', fontSize: '12px' }}>â† ã“ã®å¾Œ</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                {insertPosition && (
                                                    <div className="hint">
                                                        âœ“ é¸æŠä¸­: {
                                                            insertPosition.type === 'before' && insertPosition.index === 0 
                                                                ? 'ä¸€ç•ªæœ€åˆ' 
                                                                : `${blocks[insertPosition.index].content.substring(0, 15)}... ã®å¾Œ`
                                                        }
                                                    </div>
                                                )}
                                            </div>

                                            <div className="input-group">
                                                <label className="label">ã‚³ãƒ¼ãƒ‰ï¼ˆæ”¹è¡Œã§è¤‡æ•°è¡Œï¼‰</label>
                                                <textarea
                                                    value={chordInput}
                                                    onChange={(e) => setChordInput(e.target.value)}
                                                    className="textarea"
                                                    placeholder="C&#10;Am&#10;F&#10;G"
                                                    style={{ minHeight: '100px' }}
                                                ></textarea>
                                                <div className="hint">ğŸ’¡ æ”¹è¡Œã™ã‚‹ã¨åˆ¥ã€…ã®ã‚³ãƒ¼ãƒ‰è¡Œã«ãªã‚Šã¾ã™</div>
                                            </div>
                                            <div className="input-group">
                                                <label className="label">æ–‡å­—ã‚µã‚¤ã‚º</label>
                                                <select value={chordSize} onChange={(e) => setChordSize(parseInt(e.target.value))} className="select">
                                                    {[12, 14, 16, 18, 20, 22, 24, 28, 32].map(size => (
                                                        <option key={size} value={size}>{size}pt</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <button onClick={addChord} className="btn btn-primary">
                                                é¸æŠä½ç½®ã«è¿½åŠ 
                                            </button>
                                        </>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* ä¸€æ‹¬æ“ä½œ */}
                        {selectedChars.length > 0 && (
                            <div className="card">
                                <div className="card-title">é¸æŠæ–‡å­—ã®æ“ä½œ</div>
                                <div className="input-group">
                                    <div style={{ background: '#dbeafe', padding: '8px 12px', borderRadius: '8px', marginBottom: '8px', fontSize: '14px', fontWeight: '600' }}>
                                        {selectedChars.length}æ–‡å­—é¸æŠä¸­
                                    </div>
                                    <label className="label">æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´</label>
                                    <select className="select" onChange={(e) => e.target.value && changeSelectedCharsSize(parseInt(e.target.value))} defaultValue="">
                                        <option value="">é¸æŠ...</option>
                                        {[12, 14, 16, 18, 20, 22, 24, 28, 32].map(size => (
                                            <option key={size} value={size}>{size}pt</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        )}

                        {/* ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ */}
                        <div className="card">
                            <div className="card-title">ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§</div>
                            
                            {selectedBlocks.length > 0 && (
                                <div className="selection-controls">
                                    <div style={{ fontSize: '14px', fontWeight: '600', marginBottom: '8px' }}>
                                        {selectedBlocks.length}å€‹é¸æŠä¸­
                                    </div>
                                    <div style={{ display: 'flex', gap: '8px' }}>
                                        <button onClick={moveSelectedBlocksUp} className="btn btn-small btn-primary">â†‘ ä¸Šã¸</button>
                                        <button onClick={moveSelectedBlocksDown} className="btn btn-small btn-primary">â†“ ä¸‹ã¸</button>
                                        <button onClick={deleteSelectedBlocks} className="btn btn-small btn-danger">å‰Šé™¤</button>
                                        <button onClick={() => setSelectedBlocks([])} className="btn btn-small" style={{ background: '#e5e7eb' }}>è§£é™¤</button>
                                    </div>
                                </div>
                            )}
                            
                            {blocks.length === 0 ? (
                                <div className="empty-state">
                                    <div style={{ fontSize: '48px', marginBottom: '12px' }}>ğŸ¸</div>
                                    <div>ã‚³ãƒ”ãƒšã¾ãŸã¯æ­Œè©ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div>
                                </div>
                            ) : (
                                <div>
                                    <div style={{ marginBottom: '12px' }}>
                                        <button onClick={toggleSelectAll} className="btn btn-small" style={{ background: '#e5e7eb' }}>
                                            {selectedBlocks.length === blocks.length ? 'å…¨è§£é™¤' : 'å…¨é¸æŠ'}
                                        </button>
                                    </div>
                                    {blocks.map((block, index) => (
                                        <div key={block.id} className={`block-item ${block.type === 'chord' ? 'block-chord' : 'block-lyric'}`}>
                                            <input 
                                                type="checkbox"
                                                className="block-checkbox"
                                                checked={selectedBlocks.includes(block.id)}
                                                onChange={() => toggleBlockSelection(block.id)}
                                            />
                                            <div className="block-content">
                                                <div className="block-header">
                                                    <div className="block-type">
                                                        <span>{block.type === 'chord' ? 'ğŸµ' : 'ğŸ¤'}</span>
                                                        <span>{block.type === 'chord' ? 'ã‚³ãƒ¼ãƒ‰' : 'æ­Œè©'}</span>
                                                        <span className="badge">{block.fontSize}pt</span>
                                                    </div>
                                                    <div className="block-controls">
                                                        <button onClick={() => deleteBlock(block.id)} className="icon-btn icon-btn-danger">Ã—</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    {block.type === 'chord' ? (
                                                        <div style={{ fontSize: `${block.fontSize}px`, fontWeight: 'bold', color: '#3b82f6' }}>
                                                            {block.content}
                                                        </div>
                                                    ) : (
                                                        <div>
                                                            {block.content.split('').map((char, charIdx) => (
                                                                <span
                                                                    key={charIdx}
                                                                    className={`char-box ${selectedChars.includes(`${block.id}-${charIdx}`) ? 'selected' : ''}`}
                                                                    style={{ fontSize: `${block.charSizes[charIdx]}px` }}
                                                                    onClick={() => toggleCharSelection(block.id, charIdx)}
                                                                >
                                                                    {char}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {/* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */}
                        {blocks.length > 0 && (
                            <div className="card">
                                <div className="card-title">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
                                <div style={{ marginBottom: '8px', fontSize: '14px', fontWeight: '600', color: '#6b7280' }}>
                                    Key: {getKeyDisplay()}
                                </div>
                                <div className="preview">
                                    {blocks.map((block) => (
                                        <div key={block.id}>
                                            {block.type === 'chord' ? (
                                                <div className="preview-chord" style={{ fontSize: `${block.fontSize}px` }}>
                                                    {block.content}
                                                </div>
                                            ) : (
                                                <div className="preview-lyric">
                                                    {block.content.split('').map((char, charIdx) => (
                                                        <span key={charIdx} style={{ fontSize: `${block.charSizes[charIdx]}px` }}>
                                                            {char}
                                                        </span>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* ä½¿ã„æ–¹ */}
                        <div className="card" style={{ background: '#fffbeb', border: '2px solid #fbbf24' }}>
                            <div className="card-title" style={{ color: '#92400e' }}>ğŸ’¡ ä½¿ã„æ–¹</div>
                            <div style={{ fontSize: '14px', color: '#78350f', lineHeight: '1.8' }}>
                                <p><strong>ãŠã™ã™ã‚:</strong> ğŸ“‹ã‚³ãƒ”ãƒšã‚¿ãƒ–ã§U-FRETã‹ã‚‰ä¸€æ°—ã«å–ã‚Šè¾¼ã¿ï¼</p>
                                <p><strong>1. ã‚­ãƒ¼é¸æŠ:</strong> æ›²ã®ã‚­ãƒ¼ã¨ãƒ¡ã‚¸ãƒ£ãƒ¼/ãƒã‚¤ãƒŠãƒ¼ã‚’é¸æŠ</p>
                                <p><strong>2. ã‚³ãƒ”ãƒš:</strong> U-FRETã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘</p>
                                <p><strong>3. æ‰‹å‹•å…¥åŠ›:</strong> æ­Œè©ã‚¿ãƒ–ã§æ­Œè©è¿½åŠ â†’ã‚³ãƒ¼ãƒ‰ã‚¿ãƒ–ã§ã‚³ãƒ¼ãƒ‰è¿½åŠ </p>
                                <p><strong>4. è¤‡æ•°é¸æŠ:</strong> ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠã—ã¦ã¾ã¨ã‚ã¦ç§»å‹•</p>
                                <p><strong>5. æ–‡å­—èª¿æ•´:</strong> æ­Œè©ã®æ–‡å­—ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠâ†’ã‚µã‚¤ã‚ºå¤‰æ›´</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BlockEditor />, document.getElementById('root'));
    </script>
</body>
</html>
