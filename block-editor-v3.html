<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ–ãƒ­ãƒƒã‚¯å¼ã‚³ãƒ¼ãƒ‰è­œ v3</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding-bottom: 80px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .header h1 { font-size: 28px; font-weight: bold; margin-bottom: 8px; }
        .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card-title { font-size: 20px; font-weight: bold; margin-bottom: 16px; color: #333; }
        .tabs { display: flex; gap: 12px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .tab-inactive { background: #e5e7eb; color: #6b7280; }
        .tab-chord { background: #3b82f6; color: white; }
        .tab-lyric { background: #f59e0b; color: white; }
        .input-group { margin-bottom: 20px; }
        .label { display: block; font-size: 15px; font-weight: 600; color: #374151; margin-bottom: 10px; }
        .input { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; }
        .input:focus { outline: none; border-color: #3b82f6; }
        .textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; min-height: 150px; resize: vertical; font-family: 'Courier New', monospace; }
        .select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; background: white; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-small { padding: 10px 16px; font-size: 14px; width: auto; display: inline-block; margin: 4px; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .key-selector { display: flex; gap: 12px; align-items: center; }
        .key-note { flex: 1; }
        .key-type { display: flex; gap: 12px; }
        .key-type-btn { flex: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .key-type-btn:hover { background: #f3f4f6; }
        .key-type-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .block-item { background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px; display: flex; align-items: flex-start; gap: 16px; }
        .block-checkbox { width: 20px; height: 20px; margin-top: 4px; cursor: pointer; }
        .block-content { flex: 1; }
        .block-chord { border-left: 4px solid #3b82f6; background: #eff6ff; }
        .block-lyric { border-left: 4px solid #f59e0b; background: #fffbeb; }
        .block-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .block-type { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: #6b7280; }
        .block-controls { display: flex; gap: 8px; }
        .icon-btn { width: 36px; height: 36px; border: none; border-radius: 6px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; background: #f3f4f6; color: #6b7280; transition: all 0.2s; }
        .icon-btn:hover { background: #e5e7eb; }
        .icon-btn-danger { background: #fee2e2; color: #dc2626; }
        .icon-btn-danger:hover { background: #fecaca; }
        .insert-position { background: #f0fdf4; border: 2px solid #22c55e; border-radius: 8px; padding: 16px; margin-bottom: 20px; max-height: 300px; overflow-y: auto; }
        .insert-position-item { padding: 12px; margin-bottom: 8px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
        .insert-position-item:hover { background: #f3f4f6; }
        .insert-position-item.selected { background: #dbeafe; border-color: #3b82f6; }
        .preview { background: #f9fafb; border-radius: 8px; padding: 20px; min-height: 200px; }
        .preview-chord { color: #3b82f6; font-weight: bold; margin-bottom: 6px; }
        .preview-lyric { margin-bottom: 6px; line-height: 1.6; }
        .empty-state { text-align: center; padding: 60px 20px; color: #9ca3af; }
        .badge { display: inline-block; background: #e5e7eb; color: #6b7280; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .hint { font-size: 14px; color: #6b7280; margin-top: 8px; line-height: 1.6; }
        .selection-controls { background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .char-box { display: inline-block; padding: 6px 8px; margin: 2px; border: 2px solid #e5e7eb; border-radius: 4px; cursor: pointer; min-width: 28px; text-align: center; transition: all 0.1s; }
        .char-box:hover { background: #f3f4f6; }
        .char-box.selected { background: #3b82f6; color: white; border-color: #3b82f6; }
        
        /* ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆèª¬æ˜ */
        .setup-box { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 3px solid #f59e0b; border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .setup-title { font-size: 22px; font-weight: bold; color: #78350f; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .step { background: white; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid #f59e0b; }
        .step-number { display: inline-block; background: #3b82f6; color: white; width: 28px; height: 28px; border-radius: 50%; text-align: center; line-height: 28px; font-weight: bold; margin-right: 10px; }
        .bookmarklet-link { display: inline-block; background: #3b82f6; color: white; padding: 16px 24px; border-radius: 8px; font-weight: bold; font-size: 16px; text-decoration: none; margin: 16px 0; cursor: move; border: 3px dashed #1e40af; }
        .bookmarklet-link:hover { background: #2563eb; }
        .arrow { font-size: 32px; color: #f59e0b; text-align: center; margin: 12px 0; }
        .success-msg { background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; padding: 16px; margin-top: 16px; color: #065f46; font-weight: 600; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const BlockEditor = () => {
            const [blocks, setBlocks] = useState([]);
            const [activeTab, setActiveTab] = useState('lyric');
            const [songKey, setSongKey] = useState('C');
            const [keyType, setKeyType] = useState('major');
            
            const [lyricInput, setLyricInput] = useState('');
            const [lyricSize, setLyricSize] = useState(20);
            
            const [chordInput, setChordInput] = useState('');
            const [chordSize, setChordSize] = useState(16);
            const [insertPosition, setInsertPosition] = useState(null);
            
            const [selectedBlocks, setSelectedBlocks] = useState([]);
            const [selectedChars, setSelectedChars] = useState([]);
            const [showSetup, setShowSetup] = useState(true);

            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•èª­ã¿è¾¼ã¿
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const dataParam = params.get('data');
                
                if (dataParam) {
                    try {
                        const decoded = decodeURIComponent(dataParam);
                        const data = JSON.parse(decoded);
                        
                        if (data.blocks && Array.isArray(data.blocks)) {
                            const importedBlocks = data.blocks.map((block, idx) => ({
                                ...block,
                                id: Date.now() + idx
                            }));
                            
                            setBlocks(importedBlocks);
                            setShowSetup(false);
                            
                            // URLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ã™ã‚‹
                            window.history.replaceState({}, '', window.location.pathname);
                        }
                    } catch (error) {
                        console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                    }
                }
            }, []);

            const addLyric = () => {
                if (!lyricInput.trim()) return;
                const lines = lyricInput.split('\n').filter(line => line.trim());
                const newBlocks = lines.map((line, idx) => ({
                    id: Date.now() + idx,
                    type: 'lyric',
                    content: line,
                    fontSize: lyricSize,
                    charSizes: line.split('').map(() => lyricSize)
                }));
                setBlocks([...blocks, ...newBlocks]);
                setLyricInput('');
            };

            const addChord = () => {
                if (!chordInput.trim() || insertPosition === null) {
                    alert('ã‚³ãƒ¼ãƒ‰ã¨æŒ¿å…¥ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const lines = chordInput.split('\n').filter(line => line.trim());
                const newChordBlocks = lines.map((line, idx) => ({
                    id: Date.now() + idx,
                    type: 'chord',
                    content: line.trim(),
                    fontSize: chordSize
                }));

                const newBlocks = [...blocks];
                let insertIndex = insertPosition.type === 'after' ? insertPosition.index + 1 : insertPosition.index;
                newBlocks.splice(insertIndex, 0, ...newChordBlocks);
                setBlocks(newBlocks);
                setChordInput('');
                setInsertPosition(null);
            };

            const deleteBlock = (id) => {
                setBlocks(blocks.filter(b => b.id !== id));
                setSelectedBlocks(selectedBlocks.filter(sid => sid !== id));
            };

            const deleteSelectedBlocks = () => {
                if (selectedBlocks.length === 0) return;
                if (!confirm(`${selectedBlocks.length}å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
                setBlocks(blocks.filter(b => !selectedBlocks.includes(b.id)));
                setSelectedBlocks([]);
            };

            const toggleBlockSelection = (id) => {
                if (selectedBlocks.includes(id)) {
                    setSelectedBlocks(selectedBlocks.filter(sid => sid !== id));
                } else {
                    setSelectedBlocks([...selectedBlocks, id]);
                }
            };

            const toggleSelectAll = () => {
                if (selectedBlocks.length === blocks.length) {
                    setSelectedBlocks([]);
                } else {
                    setSelectedBlocks(blocks.map(b => b.id));
                }
            };

            const moveSelectedBlocksUp = () => {
                if (selectedBlocks.length === 0) return;
                const selectedIndices = blocks.map((b, idx) => selectedBlocks.includes(b.id) ? idx : -1).filter(idx => idx !== -1).sort((a, b) => a - b);
                if (selectedIndices[0] === 0) return;
                const newBlocks = [...blocks];
                selectedIndices.forEach(idx => {
                    [newBlocks[idx], newBlocks[idx - 1]] = [newBlocks[idx - 1], newBlocks[idx]];
                });
                setBlocks(newBlocks);
            };

            const moveSelectedBlocksDown = () => {
                if (selectedBlocks.length === 0) return;
                const selectedIndices = blocks.map((b, idx) => selectedBlocks.includes(b.id) ? idx : -1).filter(idx => idx !== -1).sort((a, b) => b - a);
                if (selectedIndices[0] === blocks.length - 1) return;
                const newBlocks = [...blocks];
                selectedIndices.forEach(idx => {
                    [newBlocks[idx], newBlocks[idx + 1]] = [newBlocks[idx + 1], newBlocks[idx]];
                });
                setBlocks(newBlocks);
            };

            const toggleCharSelection = (blockId, charIndex) => {
                const key = `${blockId}-${charIndex}`;
                if (selectedChars.includes(key)) {
                    setSelectedChars(selectedChars.filter(k => k !== key));
                } else {
                    setSelectedChars([...selectedChars, key]);
                }
            };

            const changeSelectedCharsSize = (newSize) => {
                if (selectedChars.length === 0) return;
                const newBlocks = blocks.map(block => {
                    if (block.type === 'lyric') {
                        const newCharSizes = [...block.charSizes];
                        selectedChars.forEach(key => {
                            const [blockId, charIdx] = key.split('-');
                            if (parseInt(blockId) === block.id) {
                                newCharSizes[parseInt(charIdx)] = newSize;
                            }
                        });
                        return { ...block, charSizes: newCharSizes };
                    }
                    return block;
                });
                setBlocks(newBlocks);
                setSelectedChars([]);
            };

            const getKeyDisplay = () => {
                return keyType === 'minor' ? `${songKey}m` : songKey;
            };

            // ã‚¢ãƒ—ãƒªã®URLï¼ˆGitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã®URLï¼‰
            const appUrl = 'https://yutaafrk-afk.github.io/my-chord-sheets/block-editor-v3.html';

            // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚³ãƒ¼ãƒ‰
            const bookmarkletCode = `javascript:(function(){const isChord=t=>{const e=t.trim();return!(!e||e.length>50||/[\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF]/.test(e))&&/^[A-G][#bâ™¯â™­]?(?:m|maj|min|sus|dim|aug|add|M|6|7|9|11|13)*(?:\\/[A-G][#bâ™¯â™­]?)?( +[A-G][#bâ™¯â™­]?(?:m|maj|min|sus|dim|aug|add|M|6|7|9|11|13)*(?:\\/[A-G][#bâ™¯â™­]?)?)*$/.test(e)};const blocks=[];document.querySelectorAll('pre, code').forEach(el=>{const lines=(el.textContent||'').split('\\n');lines.forEach(line=>{const t=line.trim();if(!t||t.length<1)return;if(isChord(t)){blocks.push({type:'chord',content:t,fontSize:16})}else if(t.length<100){blocks.push({type:'lyric',content:t,fontSize:20,charSizes:t.split('').map(()=>20)})}})});if(blocks.length===0){alert('ã‚³ãƒ¼ãƒ‰è­œã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ');return}const data=JSON.stringify({blocks});const url='${appUrl}?data='+encodeURIComponent(data);window.location.href=url})();`;

            return (
                <div>
                    <div className="header">
                        <h1>ğŸ¸ ãƒ–ãƒ­ãƒƒã‚¯å¼ã‚³ãƒ¼ãƒ‰è­œ v3</h1>
                        <div style={{ fontSize: '16px', marginTop: '8px', opacity: 0.9 }}>
                            {blocks.length}å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ | Key: {getKeyDisplay()}
                        </div>
                    </div>

                    <div className="container">
                        {showSetup && (
                            <div className="setup-box">
                                <div className="setup-title">
                                    âš¡ï¸ åˆå›è¨­å®šï¼ˆ1å›ã ã‘ï¼‰
                                    <button 
                                        onClick={() => setShowSetup(false)}
                                        style={{ marginLeft: 'auto', border: 'none', background: 'transparent', fontSize: '24px', cursor: 'pointer', color: '#78350f' }}
                                    >Ã—</button>
                                </div>
                                
                                <div className="step">
                                    <span className="step-number">1</span>
                                    <strong>ä¸‹ã®é’ã„ãƒœã‚¿ãƒ³ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°</strong>
                                </div>
                                
                                <div style={{ textAlign: 'center', background: 'white', padding: '20px', borderRadius: '8px', margin: '16px 0' }}>
                                    <a href={bookmarkletCode} className="bookmarklet-link">
                                        ğŸ“ ã‚³ãƒ¼ãƒ‰è­œå–è¾¼
                                    </a>
                                    <div style={{ fontSize: '13px', color: '#6b7280', marginTop: '8px' }}>
                                        â†‘ ã“ã®ãƒœã‚¿ãƒ³ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
                                    </div>
                                </div>

                                <div className="arrow">â†“</div>

                                <div className="step">
                                    <span className="step-number">2</span>
                                    <strong>U-FRETã§æ›²ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã</strong>
                                    <div style={{ fontSize: '14px', color: '#6b7280', marginTop: '6px' }}>
                                        ä¾‹: https://www.ufret.jp/song.php?data=73678
                                    </div>
                                </div>

                                <div className="arrow">â†“</div>

                                <div className="step">
                                    <span className="step-number">3</span>
                                    <strong>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã®ã€Œã‚³ãƒ¼ãƒ‰è­œå–è¾¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</strong>
                                </div>

                                <div className="success-msg">
                                    âœ… è‡ªå‹•çš„ã«ã“ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã£ã¦ãã¦ã‚³ãƒ¼ãƒ‰è­œãŒå–ã‚Šè¾¼ã¾ã‚Œã¾ã™ï¼
                                </div>
                            </div>
                        )}

                        <div className="card">
                            <div className="card-title">æ›²ã®ã‚­ãƒ¼</div>
                            <div className="key-selector">
                                <div className="key-note">
                                    <select value={songKey} onChange={(e) => setSongKey(e.target.value)} className="select">
                                        {['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'].map(note => (
                                            <option key={note} value={note}>{note}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="key-type">
                                    <button className={`key-type-btn ${keyType === 'major' ? 'active' : ''}`} onClick={() => setKeyType('major')}>ãƒ¡ã‚¸ãƒ£ãƒ¼</button>
                                    <button className={`key-type-btn ${keyType === 'minor' ? 'active' : ''}`} onClick={() => setKeyType('minor')}>ãƒã‚¤ãƒŠãƒ¼</button>
                                </div>
                            </div>
                        </div>

                        <div className="card">
                            <div className="card-title">å…¥åŠ›</div>
                            
                            <div className="tabs">
                                <button onClick={() => setActiveTab('lyric')} className={`tab ${activeTab === 'lyric' ? 'tab-lyric' : 'tab-inactive'}`}>ğŸ¤ æ­Œè©</button>
                                <button onClick={() => setActiveTab('chord')} className={`tab ${activeTab === 'chord' ? 'tab-chord' : 'tab-inactive'}`}>ğŸµ ã‚³ãƒ¼ãƒ‰</button>
                            </div>

                            {activeTab === 'lyric' ? (
                                <div>
                                    <div className="input-group">
                                        <label className="label">æ­Œè©ï¼ˆæ”¹è¡Œã§è¤‡æ•°è¡Œï¼‰</label>
                                        <textarea value={lyricInput} onChange={(e) => setLyricInput(e.target.value)} className="textarea" placeholder="æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;æ”¹è¡Œã§è¤‡æ•°è¡Œè¿½åŠ ã§ãã¾ã™"></textarea>
                                    </div>
                                    <div className="input-group">
                                        <label className="label">åŸºæœ¬æ–‡å­—ã‚µã‚¤ã‚º</label>
                                        <select value={lyricSize} onChange={(e) => setLyricSize(parseInt(e.target.value))} className="select">
                                            {[12, 14, 16, 18, 20, 22, 24, 28].map(size => (<option key={size} value={size}>{size}pt</option>))}
                                        </select>
                                    </div>
                                    <button onClick={addLyric} className="btn btn-warning">è¿½åŠ </button>
                                </div>
                            ) : (
                                <div>
                                    {blocks.length === 0 ? (
                                        <div className="empty-state" style={{ padding: '40px' }}>
                                            <div style={{ fontSize: '18px', color: '#6b7280' }}>å…ˆã«æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="insert-position">
                                                <label className="label">æŒ¿å…¥ä½ç½®ã‚’é¸æŠ</label>
                                                <div className={`insert-position-item ${insertPosition?.type === 'before' && insertPosition?.index === 0 ? 'selected' : ''}`} onClick={() => setInsertPosition({ type: 'before', index: 0 })}>
                                                    <span>ğŸ“ ä¸€ç•ªæœ€åˆ</span>
                                                </div>
                                                {blocks.map((block, idx) => (
                                                    <div key={block.id} className={`insert-position-item ${insertPosition?.type === 'after' && insertPosition?.index === idx ? 'selected' : ''}`} onClick={() => setInsertPosition({ type: 'after', index: idx })}>
                                                        <span>{block.type === 'chord' ? 'ğŸµ' : 'ğŸ¤'} {block.content.substring(0, 30)}{block.content.length > 30 ? '...' : ''}</span>
                                                        <span style={{ color: '#6b7280', fontSize: '13px' }}>â† ã“ã®å¾Œ</span>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="input-group">
                                                <label className="label">ã‚³ãƒ¼ãƒ‰ï¼ˆæ”¹è¡Œã§è¤‡æ•°è¡Œï¼‰</label>
                                                <textarea value={chordInput} onChange={(e) => setChordInput(e.target.value)} className="textarea" placeholder="C&#10;Am&#10;F&#10;G" style={{ minHeight: '120px' }}></textarea>
                                            </div>
                                            <div className="input-group">
                                                <label className="label">æ–‡å­—ã‚µã‚¤ã‚º</label>
                                                <select value={chordSize} onChange={(e) => setChordSize(parseInt(e.target.value))} className="select">
                                                    {[12, 14, 16, 18, 20, 22, 24, 28, 32].map(size => (<option key={size} value={size}>{size}pt</option>))}
                                                </select>
                                            </div>
                                            <button onClick={addChord} className="btn btn-primary">é¸æŠä½ç½®ã«è¿½åŠ </button>
                                        </>
                                    )}
                                </div>
                            )}
                        </div>

                        {selectedChars.length > 0 && (
                            <div className="card">
                                <div className="card-title">é¸æŠæ–‡å­—ã®æ“ä½œ</div>
                                <div className="input-group">
                                    <div style={{ background: '#dbeafe', padding: '10px 14px', borderRadius: '8px', marginBottom: '12px', fontSize: '15px', fontWeight: '600' }}>
                                        {selectedChars.length}æ–‡å­—é¸æŠä¸­
                                    </div>
                                    <label className="label">æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´</label>
                                    <select className="select" onChange={(e) => e.target.value && changeSelectedCharsSize(parseInt(e.target.value))} defaultValue="">
                                        <option value="">é¸æŠ...</option>
                                        {[12, 14, 16, 18, 20, 22, 24, 28, 32].map(size => (<option key={size} value={size}>{size}pt</option>))}
                                    </select>
                                </div>
                            </div>
                        )}

                        <div className="card">
                            <div className="card-title">ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§</div>
                            {selectedBlocks.length > 0 && (
                                <div className="selection-controls">
                                    <div style={{ fontSize: '15px', fontWeight: '600', marginBottom: '12px' }}>{selectedBlocks.length}å€‹é¸æŠä¸­</div>
                                    <div style={{ display: 'flex', gap: '8px' }}>
                                        <button onClick={moveSelectedBlocksUp} className="btn btn-small btn-primary">â†‘ ä¸Šã¸</button>
                                        <button onClick={moveSelectedBlocksDown} className="btn btn-small btn-primary">â†“ ä¸‹ã¸</button>
                                        <button onClick={deleteSelectedBlocks} className="btn btn-small btn-danger">å‰Šé™¤</button>
                                        <button onClick={() => setSelectedBlocks([])} className="btn btn-small" style={{ background: '#e5e7eb' }}>è§£é™¤</button>
                                    </div>
                                </div>
                            )}
                            {blocks.length === 0 ? (
                                <div className="empty-state">
                                    <div style={{ fontSize: '48px', marginBottom: '16px' }}>ğŸ¸</div>
                                    <div style={{ fontSize: '18px' }}>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§å–ã‚Šè¾¼ã‚€ã‹<br/>æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                                </div>
                            ) : (
                                <div>
                                    <div style={{ marginBottom: '16px' }}>
                                        <button onClick={toggleSelectAll} className="btn btn-small" style={{ background: '#e5e7eb' }}>
                                            {selectedBlocks.length === blocks.length ? 'å…¨è§£é™¤' : 'å…¨é¸æŠ'}
                                        </button>
                                    </div>
                                    {blocks.map((block) => (
                                        <div key={block.id} className={`block-item ${block.type === 'chord' ? 'block-chord' : 'block-lyric'}`}>
                                            <input type="checkbox" className="block-checkbox" checked={selectedBlocks.includes(block.id)} onChange={() => toggleBlockSelection(block.id)} />
                                            <div className="block-content">
                                                <div className="block-header">
                                                    <div className="block-type">
                                                        <span>{block.type === 'chord' ? 'ğŸµ' : 'ğŸ¤'}</span>
                                                        <span>{block.type === 'chord' ? 'ã‚³ãƒ¼ãƒ‰' : 'æ­Œè©'}</span>
                                                        <span className="badge">{block.fontSize}pt</span>
                                                    </div>
                                                    <div className="block-controls">
                                                        <button onClick={() => deleteBlock(block.id)} className="icon-btn icon-btn-danger">Ã—</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    {block.type === 'chord' ? (
                                                        <div style={{ fontSize: `${block.fontSize}px`, fontWeight: 'bold', color: '#3b82f6' }}>{block.content}</div>
                                                    ) : (
                                                        <div>
                                                            {block.content.split('').map((char, charIdx) => (
                                                                <span key={charIdx} className={`char-box ${selectedChars.includes(`${block.id}-${charIdx}`) ? 'selected' : ''}`} style={{ fontSize: `${block.charSizes[charIdx]}px` }} onClick={() => toggleCharSelection(block.id, charIdx)}>{char}</span>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        {blocks.length > 0 && (
                            <div className="card">
                                <div className="card-title">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
                                <div style={{ marginBottom: '12px', fontSize: '15px', fontWeight: '600', color: '#6b7280' }}>Key: {getKeyDisplay()}</div>
                                <div className="preview">
                                    {blocks.map((block) => (
                                        <div key={block.id}>
                                            {block.type === 'chord' ? (
                                                <div className="preview-chord" style={{ fontSize: `${block.fontSize}px` }}>{block.content}</div>
                                            ) : (
                                                <div className="preview-lyric">{block.content.split('').map((char, charIdx) => (<span key={charIdx} style={{ fontSize: `${block.charSizes[charIdx]}px` }}>{char}</span>))}</div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="card" style={{ background: '#eff6ff', border: '2px solid #3b82f6' }}>
                            <div className="card-title" style={{ color: '#1e40af' }}>ğŸ’¡ ä½¿ã„æ–¹ã¾ã¨ã‚</div>
                            <div style={{ fontSize: '15px', color: '#1e3a8a', lineHeight: '1.8' }}>
                                <p><strong>ğŸš€ ãŠã™ã™ã‚:</strong> ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§2ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•å–ã‚Šè¾¼ã¿</p>
                                <p><strong>âœï¸ æ‰‹å‹•å…¥åŠ›:</strong> æ­Œè©â†’ã‚³ãƒ¼ãƒ‰ã®é †ã§å…¥åŠ›</p>
                                <p><strong>ğŸ“¦ è¤‡æ•°é¸æŠ:</strong> ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ã¾ã¨ã‚ã¦ç§»å‹•</p>
                                <p><strong>ğŸ”¤ æ–‡å­—èª¿æ•´:</strong> æ­Œè©ã®æ–‡å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚µã‚¤ã‚ºå¤‰æ›´</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BlockEditor />, document.getElementById('root'));
    </script>
</body>
</html>
